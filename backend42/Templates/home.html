{% extends "base.html" %}
{% load static %}
{% block content %}
        {% if user.is_authenticated %}
            <p class="display-4">Hello, <a href="{% url 'user_profile' user.username %}">{{ user.first_name }}</a></p>
        {% endif %}

        <div>
            {% for post in all_posts %}
                {% if post.is_published %}
                    <div class="col s12 m6">
                        <div class="card blue-grey darken-1">
                            <div class="card-content white-text">
                                <h3 class="card-title"><a href="{% url 'blog:post_view' post.id %}">{{ post.title }}</a></h3>
                                <span class="date-author">
                                    Written by: <a href="{% url 'user_profile' post.author.user.username %}">{{ post.author }}</a>; Last update: {{ post.created }}
                                </span>
                                <hr>
                                <p>{{ post.content | truncatewords:50 | linebreaks }}</p>
                            </div>
                            <div class="card-action">
                                <h5>{{ post.like_set.all.count }}</h5>
                                {% if user.is_authenticated %}
                                    <a class="like-btn" href="{% url 'blog:like' post.id user.username %}">
                                        <i class="fa fa-asterisk" aria-hidden="true"></i>
                                    </a>
                                    {% if post.author.user.username == user.username %}
                                        <a href="{% url 'blog:post_edit' post.id %}">
                                            <i class="far fa-edit" aria-hidden="true"></i>
                                        </a>
                                    {% else %}
                                        <a href="{% url 'blog:fork' post.id %}">
                                            <i class="fas fa-code-branch" aria-hidden="true"></i>
                                        </a>
                                    {% endif %}
                                {% endif %}
                                <br>
                                {% if post.like_set.all %}
                                    <bold>Liked by: </bold>
                                {% endif %}
                                {% for like in post.like_set.all %}
                                    <a href="{% url 'user_profile' like.profile.user.username %}" style="display: inline-block;">{{ like.profile }}</a>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}
                <br>
                <br>
            {% endfor %}
        </div>
{% endblock content %}

{% block script %}
    <script>
        $(document).ready(function() {
            $('.like-btn').on('click', function(e) {
                e.preventDefault();
                var pageURL = $(location).attr("href");
                pageURL = pageURL.replace("home/", "")
                var url = pageURL + $(this).attr('href').slice(1);
                var post_data = {
                    'csrfmiddlewaretoken':"{{ csrf_token }}"
                }
                $.ajax({
                    url: url,
                    type: "GET",
                    success: function(data) {
                        console.log(data);
                    },
                    error: function(err) {
                        console.error('Error founded');
                    }
                });
            })
        })
    </script>
{% endblock script %}

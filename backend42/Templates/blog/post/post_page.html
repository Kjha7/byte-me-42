{% extends "base.html" %}
{% load static %}
{% block content %}
    <h3 class="card-title"><a href="{% url 'blog:post_view' posts.0.id %}">{{ posts.0.title }}</a></h3>
    {% for post in posts %}
        <div class="col s12 m6">
            <div class="card blue-grey darken-1">
                {% if user.is_authenticated and user != profile and post.is_published == False %}
                    <h4>Access Denied!!!!!</h4>
                {% else %}
                    <div class="card-content white-text">
                        <span class="date-author">
                            Written by: <a href="{% url 'user_profile' post.author.user.username %}">{{ post.author }}</a>
                            ; Last update : {{ post.created }}
                        </span>

                        <hr>
                        <p>{{ post.content | truncatewords:50 | linebreaks }}</p>
                    </div>
                    <div class="card-action">
                        <h3>{{ post.like_set.all.count }}</h3>
                        {% if user.is_authenticated %}
                            <a class="like-btn" href="{% url 'blog:like' post.id user.username %}">
                                <i class="fa fa-asterisk" aria-hidden="true"></i>
                            </a>
                            {% if post.author.user.username == user.username %}
                                <a href="{% url 'blog:post_edit' post.id %}">
                                    <i class="far fa-edit" aria-hidden="true"></i>
                                </a>
                                <a href="{% url 'blog:post_delete' post.id %}">
                                    <i class="far fa-trash-alt"></i>
                                </a>

                            {% else %}
                                <a href="{% url 'blog:fork' post.id %}">
                                    <i class="fas fa-code-branch" aria-hidden="true"></i>
                                </a>
                            {% endif %}
                        {% endif %}
                        <br>
                        {% if post.like_set.all %}
                            <bold>Liked by: </bold>
                        {% endif %}
                        {% for like in post.like_set.all %}
                            <h6 style="display: inline-block;">{{ like.profile }}</h6>
                        {% endfor %}
                    </div>
                {% endif %}

            </div>
        </div>
        <br>
        <br>

    {% endfor %}

{% endblock content %}

{% block script %}
    <script>
        $(document).ready(function() {
            $('.like-btn').on('click', function(e) {
                e.preventDefault();
                var pageURL = $(location).attr("href");
                pageURL = pageURL.split("/");
                var base = "";
                for (var i=0; i <= 2; ++i) {
                    base += pageURL[i]+"/";
                }
                var url = base + $(this).attr('href').slice(1);
                var post_data = {
                    'csrfmiddlewaretoken':"{{ csrf_token }}"
                }
                $.ajax({
                    url: url,
                    type: "GET",
                    success: function(data) {
                        console.log(data);
                    },
                    error: function(err) {
                        console.error('Error founded');
                    }
                });
            })
        })
    </script>
{% endblock script %}